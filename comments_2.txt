ПОЯСНЕНИЯ К ВЫБРАННОЙ МОДЕЛИ ДАННЫХ

1. СТРУКТУРА БАЗЫ ДАННЫХ
База данных разделена на две схемы:
- raw_data: для хранения исходных (сырых) данных
- car_shop: нормализованная схема для анализа

2. НОРМАЛИЗАЦИЯ ДО 3NF
Выбрана нормализация до третьей нормальной формы (3NF):
- Устранена избыточность данных
- Созданы отдельные таблицы для сущностей: страны, бренды, модели, цвета, покупатели
- Все таблицы связаны через внешние ключи
- Отсутствуют транзитивные зависимости

3. ВЫБОР ТИПОВ ДАННЫХ
- SERIAL: для автоинкрементных первичных ключей
- VARCHAR: для текстовых полей переменной длины
- NUMERIC: для финансовых данных (цена, скидка) для точности вычислений
- DATE: для дат продаж
- TIMESTAMP: для временных меток создания записей
- INTEGER: для внешних ключей

4. ОБОСНОВАНИЕ СТРУКТУРЫ
- Таблица colors: позволяет стандартизировать цвета и легко добавлять новые
- Покупатели уникальны по телефону: позволяет отслеживать историю покупок клиентов
- Цена в sales хранится уже с учетом скидки (согласно описанию задачи)
- Для восстановления цены без скидки используется формула: price / (1 - discount/100)

5. ОГРАНИЧЕНИЯ ЦЕЛОСТНОСТИ
- PRIMARY KEY: уникальные идентификаторы во всех таблицах
- FOREIGN KEY: поддержание ссылочной целостности между таблицами
- CHECK constraints: 
  * price > 0 AND price < 10000000 (цена не более 7 цифр)
  * discount >= 0 AND discount <= 100 (скидка от 0% до 100%)
  * gasoline_consumption < 100 (расход не трехзначный)
- UNIQUE constraints: предотвращение дублирования данных
- NOT NULL: для обязательных полей

6. ПРОЦЕСС НАПОЛНЕНИЯ ДАННЫХ
- Созданы вспомогательные функции для разбора поля auto
- Данные переносятся из raw_data.sales в нормализованные таблицы с помощью INSERT ... SELECT
- Использованы ON CONFLICT DO NOTHING для предотвращения дубликатов

7. ВЫПОЛНЕНИЕ ЗАПРОСОВ
Все аналитические запросы выполняются на нормализованных таблицах схемы car_shop, что обеспечивает:
- Более эффективные запросы за счет индексов
- Чистую структуру данных без избыточности
- Возможность расширения и модификации
- Более читаемые и поддерживаемые SQL-запросы

8. ОБРАБОТКА КРАЙНИХ СЛУЧАЕВ
- Использование COALESCE для обработки NULL значений
- Защита от деления на ноль (NULLIF, проверка discount < 100)
- Фильтрация NULL значений в WHERE условиях
- Использование DISTINCT где необходимо

ВОПРОСЫ РЕВЬЮЕРУ:
1. Достаточна ли выбранная степень нормализации для данной задачи?
2. Есть ли рекомендации по оптимизации производительности запросов?
3. Корректна ли обработка данных о Porsche (brand_origin = NULL в исходных данных)?
4. Можно ли улучшить структуру для будущего масштабирования?